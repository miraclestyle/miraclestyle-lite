<div fit-in-dialog>
<form method="post" target="_blank" name="container.paypalForm" action="https://www.sandbox.paypal.com/cgi-bin/webscr">
<div class="modal-body overflow-hidden fixed-height has-footer">
  <div class="include-footer-height overflow-y fixed-height">
    <div class="modal-body-inner-padded">
      <div ng-form method="post" name="container.form">
            <div form-input="fields.billingAddress"></div>
            <div form-input="fields.shippingAddress"></div>
            <div form-input="fields.carrier"></div>
      </div>
      <div class="cart">
        <input type="hidden" name="cmd" value="_cart" />
        <input type="hidden" name="upload" value="1" />
        <input type="hidden" name="charset" value="utf-8" />
        <input type="hidden" name="invoice" value="{{order.key}}" />
        <input type="hidden" name="no_shipping" value="2">
        <input type="hidden" name="business" value="{{order._payment_method.business}}" />
        <input type="hidden" name="return" value="{{completePath}}" />
        <input type="hidden" name="cancel_return" value="{{cancelPath}}" />
        <input type="hidden" name="notify_url" value="{{notifyUrl}}" />
        <input type="hidden" name="rm" value="1" />
        <input type="hidden" name="currency_code" value="{{order.currency.code}}" />
        <input type="hidden" name="custom" value="{{order.key}}" />
        <input type="hidden" name="address_override" value="1" />
        <input type="hidden" name="first_name" value="{{order.shipping_address.name}}" />
        <input type="hidden" name="address1" value="{{order.shipping_address.street}}" />
        <input ng-if="order.shipping_address.street2" type="hidden" name="address2" value="{{order.shipping_address.street2}}" />
        <input type="hidden" name="city" value="{{order.shipping_address.city}}" />
        <input ng-if="order.shipping_address.country_code === 'US'" type="hidden" name="state" value="{{order.shipping_address.region_code|substr:3}}" />
        <input ng-if="order.shipping_address.postal_code" type="hidden" name="zip" value="{{order.shipping_address.postal_code}}" />
        <input type="hidden" name="country" value="{{order.shipping_address.country_code}}" />
        <input type="hidden" name="email" value="{{order.shipping_address.email}}" />
        <input type="hidden" name="tax_cart" value="{{order.tax_amount}}" />
        <input type="hidden" name="handling_cart" value="{{order.carrier.subtotal}}" />
              <div class="cart-lines item-list">
                <div class="cart-line item clearfix" ng-hide="line._state === 'deleted'" ng-repeat="line in order._lines track by $index">
                    <div class="cart-line-left item-left">
                      <button loading ng-click="viewProduct(line)" class="button-transparent cart-line-product">
                        <div class="cart-line-product-name">
                          {{line.product.name}}
                        </div>
                        <div class="cart-line-product-code">
                          {{line.product.code}}
                        </div>
                        <div class="cart-line-product-variant_signature" ng-show="line.product.variant_signature">
                            <div ng-repeat="variant in line.product.variant_signature track by $index">
                                <div ng-repeat="(key, value) in variant track by key">
                                  <span class="cart-label">{{key}}:</span>
                                  <span class="cart-value">{{value}}</span>
                                </div>
                            </div>
                        </div>
                        <div class="cart-line-product-unit_price">
                            {{line.product.unit_price|displayCurrency:order.currency}} ({{order.currency.code}})
                        </div>
                      </button>
                    </div>
                    <div class="cart-line-right item-right list-actions">
                      <button ng-click="remove(line)" loading="!order.ui.rule.field._lines.quantity.writable" type="button" class="button">Remove</button>
                        <table>
                          <tbody>
                            <tr class="cart-line-quantity">
                              <td class="cart-label">Quantity ({{line.product.uom.symbol}})</td>
                              <td class="cart-value">
                                <input ng-disabled="!order.ui.rule.field._lines.quantity.writable" type="numeric" ng-model="line.quantity"/>
                              </td>
                            </tr>
                            <tr class="cart-line-discount" ng-show="line.discount > 0">
                              <td class="cart-label">Discount (%)</td>
                              <td class="cart-value">{{line.discount}}</td>
                            </tr>
                            <tr class="cart-line-discount_subtotal">
                              <td class="cart-label">Subtotal</td>
                              <td class="cart-value">{{line.discount_subtotal|displayCurrency:order.currency}}</td>
                            </tr>
                          </tbody>
                        </table>
                        <input type="hidden" value="{{line.product.name}}" name="item_name_{{line.sequence}}" />
                        <input type="hidden" value="{{line.sequence}}" name="item_number_{{line.sequence}}" />
                        <input type="hidden" value="{{line.quantity}}" name="quantity_{{line.sequence}}" />
                        <input type="hidden" value="{{line.product.unit_price}}" name="amount_{{line.sequence}}" />
                        <input type="hidden" value="{{line.discount}}" name="discount_rate_{{line.sequence}}" />
                    </div>
                </div>
        </div>
      <div class="cart-totals clearfix">
          <table class="pull-right">
            <tbody>
              <tr class="cart-carrier-subtotal">
                <td class="cart-label">Shipping &amp; Handling</td>
                <td class="cart-value">{{order.carrier.subtotal|displayCurrency:order.currency}}</td>
              </tr>
              <tr class="cart-untaxed_amount">
                <td class="cart-label">Net Total</td>
                <td class="cart-value">{{order.untaxed_amount|displayCurrency:order.currency}}</td>
              </tr>
              <tr class="cart-tax_amount">
                <td class="cart-label">Taxes</td>
                <td class="cart-value">{{order.tax_amount|displayCurrency:order.currency}}</td>
              </tr>
              <tr class="cart-total_amount">
                <td class="cart-label">Total </td>
                <td class="cart-value">{{order.total_amount|displayCurrency:order.currency}}</td>
              </tr>
              <tr class="cart-currency">
                <td class="cart-label">Currency</td>
                <td class="cart-value">{{order.currency.name}} ({{order.currency.code}})</td>
              </tr>
            </tbody>
          </table>
      </div>

      <div ng-if="order.ui.rule.action.log_message.executable">
         <div class="messages-message">
           <div form-input="fields.message"></div>
         </div>
         <div class="form-control messages-list">
           <div class="message" ng-repeat="message in order._messages">
             <div class="message-agent">{{message._agent}} - {{message|output:'created'}}</div>
             <div class="message-body">{{message.body}}</div>
           </div>
         </div>

         <div load-more-button="messagesReader"></div>
      </div>

      </div>
  </div>
  </div>
</div>
<div class="modal-footer">
    <button loading ng-show="order.ui.rule.action.checkout.executable && order._lines.length" ng-click="checkout()" type="button" class="button">
        Checkout
    </button>
    <button loading ng-show="order.ui.rule.action.update.executable" ng-click="update()" type="button" class="button">
        Update
    </button>
    <button loading send-message="sendMessage()" ng-show="order.ui.rule.action.log_message.executable" type="button" class="button">
        Send Message
    </button>
    <button loading ng-show="order.ui.rule.action.cancel.executable" type="submit" class="button">
        Pay Now
    </button>
    <button loading ng-click="cancel()" ng-show="order.ui.rule.action.cancel.executable" type="button" class="button">
        Cancel Order
    </button>
    <button loading type="button" class="button" ng-click="close()">
        Close
    </button>
</div>
</form>
</div>