<% if (config.ui.label !== false) { %>
<div class="structured-field">
  <h2 class="fieldset with-button">

  <span class="fieldset-text"><%= config.ui.compiled.label %></span>
  <% if (config.repeated) { %>
  <span class="fieldset-button">
    <button ng-disabled="!<%= config.ui.writableCompiled %>" loading type="button" class="button" ng-click="config.ui.specifics.manage()">
      <%=config.ui.specifics.addText %>
    </button>
  </span>
  <% } %>
</h2>
<% } %>
<% if (config.repeated) { %>
    <table class="table">
          <thead>
            <tr> 
              <th ng-repeat="field in config.ui.specifics.listFields">{{field.label}}</th>
              <th></th>
              <!-- what else to put here? -->
            </tr>
          </thead>
          <tbody ui-sortable="config.ui.specifics.sortableOptions" 
          ng-model="config.ui.specifics.parentArgs">
            <tr ng-repeat="ent in config.ui.specifics.parentArgs" ng-hide="ent._state == 'deleted'">
              <% if (config.ui.specifics.showListItem) { %>
                <td ng-repeat="field in config.ui.specifics.listFields">
                 <span <%=config.ui.specifics.showListItem %>="ent" <%=config.ui.specifics.showListItem %>-field="field"></span>
               </td>
              <% } else { %>
              <td ng-repeat="field in config.ui.specifics.listFields">
                {{ent|output:field.key}}
              </td>
              <% } %>
  
              <td>
                <button ng-show="<%= config.ui.writableCompiled %>" ng-click="config.ui.specifics.remove(ent)" type="button" class="button">Remove</button>
                <button ng-show="<%= config.ui.writableCompiled %>" ng-click="config.ui.specifics.manage(ent)" type="button" class="button">Edit</button>
              </td>
            </tr>
          </tbody>
    </table>
    
    <% if (config.ui.specifics.remote) { %>
    <div>Remote data</div>
    <% } %>
    
    <% } else { %>
      <div ng-controller="config.ui.specifics.SingularCtrl">
        <div form-builder="config.ui.specifics.formBuilder"></div>
      </div>
    <% } %>
</div>
